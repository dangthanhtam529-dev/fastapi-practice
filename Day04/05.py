# =============================================================================
# FastAPI 请求体 - 字典类型请求体示例
# =============================================================================
# 本文件演示了如何使用字典类型作为请求体
#
# 【字典类型请求体】
# 当请求体的结构是键值对，且键和值的类型固定时，
# 可以使用 dict[KeyType, ValueType] 定义。
#
# 【使用场景】
# 1. 动态配置：接收不确定结构的配置数据
# 2. 索引权重：例如搜索引擎中的文档-权重映射
# 3. 统计信息：例如页面访问统计
# 4. 动态属性：对象有不确定的属性


# 创建 FastAPI 应用实例
app = FastAPI()


# 定义创建索引权重的路由
@app.post("/index-weights/")
async def create_index_weights(
    weights: dict[int, float]  # 请求体是字典，键为整数，值为浮点数
):
    """
    创建索引权重

    接收一个整数到浮点数的映射，常用于：
    - 搜索引擎索引
    - 推荐系统权重
    - 机器学习特征权重

    Args:
        weights: 索引-权重映射，请求体

    Returns:
        dict: 收到的权重数据

    Examples:
        请求：
        POST /index-weights/
        请求体：
        {
            "1": 0.5,
            "2": 0.3,
            "3": 0.2
        }

        响应：
        {
            "1": 0.5,
            "2": 0.3,
            "3": 0.2
        }

        请求（不同格式）：
        POST /index-weights/
        请求体：
        {
            "doc1": 0.9,
            "doc2": 0.8
        }
        返回：422 错误（键不是整数）
    """
    return weights


# 【字典类型的类型提示】
# dict[int, float]：键是整数，值是浮点数
# dict[str, int]：键是字符串，值是整数
# dict[str, any]：键是字符串，值是任意类型
# dict[int, str]：键是整数，值是字符串 curl 测试】
# curl -X POST


# 【使用 "http://localhost:8000/index-weights/" \
#      -H "Content-Type: application/json" \
#      -d '{"1": 0.5, "2": 0.3, "3": 0.2}'


# 【实际应用场景】
# 1. 搜索引擎：文档ID -> 相关性权重
# 2. 推荐系统：商品ID -> 推荐分数
# 3. 机器学习：特征ID -> 特征值
# 4. 配置管理：配置项 -> 配置值


# 【测试方法】
# 1. 运行应用：uvicorn 05:app --reload
# 2. 访问 http://localhost:8000/docs
# 3. 尝试发送不同类型的字典进行测试
